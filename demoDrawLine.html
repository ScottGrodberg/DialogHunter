<!DOCTYPE html>
<html>

<head>
    <title>SVG Drag and Draw</title>
</head>

<body>
    <div id="container" style="position: relative; width: 800px; height: 400px; border: 1px solid black;">
        <div id="socket1"
            style="z-index: 1;position: absolute; width: 20px; height: 20px; border-radius: 50%; background: blue; left: 90px; top: 190px;">
        </div>
        <div id="socket2"
            style="z-index: 2;position: absolute; width: 20px; height: 20px; border-radius: 50%; background: blue; left: 290px; top: 190px;">
        </div>
        <svg id="svgCanvas" width="800" height="400" style="position: absolute; top: 0; left: 0;"></svg>
    </div>

    <script>
        const svg = document.getElementById('svgCanvas');
        let line;

        function createArrowMarker() {
            const arrowMarker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
            arrowMarker.setAttribute("id", "arrow");
            arrowMarker.setAttribute("markerWidth", "10");
            arrowMarker.setAttribute("markerHeight", "10");
            arrowMarker.setAttribute("refX", "5");
            arrowMarker.setAttribute("refY", "5");
            arrowMarker.setAttribute("orient", "auto-start-reverse");
            arrowMarker.setAttribute("markerUnits", "strokeWidth");

            const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
            arrowPath.setAttribute("d", "M0,0 L10,5 L0,10 Z");
            arrowPath.setAttribute("fill", "black");
            arrowMarker.appendChild(arrowPath);

            return arrowMarker;
        }

        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        defs.appendChild(createArrowMarker());
        svg.appendChild(defs);

        function getSocketCenter(socket) {
            const rect = socket.getBoundingClientRect();
            const svgRect = svg.getBoundingClientRect();
            return {
                x: rect.left + rect.width / 2 - svgRect.left,
                y: rect.top + rect.height / 2 - svgRect.top,
            };
        }

        function onPointerDown(event) {
            const start = getSocketCenter(event.target);

            line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", start.x);
            line.setAttribute("y1", start.y);
            line.setAttribute("x2", start.x);
            line.setAttribute("y2", start.y);
            line.setAttribute("stroke", "black");
            line.setAttribute("stroke-width", "2");
            line.setAttribute("marker-end", "url(#arrow)");
            svg.appendChild(line);
        }

        function onPointerMove(event) {
            if (!line) return;
            const svgPoint = svg.createSVGPoint();
            svgPoint.x = event.clientX;
            svgPoint.y = event.clientY;
            const transformedPoint = svgPoint.matrixTransform(svg.getScreenCTM().inverse());

            line.setAttribute("x2", transformedPoint.x);
            line.setAttribute("y2", transformedPoint.y);
        }

        function onPointerUp(event) {
            if (!line) return;

            const end = getSocketCenter(event.target);
            line.setAttribute("x2", end.x);
            line.setAttribute("y2", end.y);
            line = undefined;
        }

        document.querySelectorAll('#socket1, #socket2').forEach(socket => {
            socket.addEventListener('pointerdown', onPointerDown);
            socket.addEventListener('pointerup', onPointerUp);
        });
        svg.addEventListener('pointermove', onPointerMove);

    </script>
</body>

</html>